<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../img/favicon.ico" />
    <title>Namespace normalization - Brel git repo</title>
    <link rel="stylesheet" href="../../css/theme.css" />
    <link rel="stylesheet" href="../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Namespace normalization";
        var mkdocs_page_input_path = "qnames/namespace-normalization.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../.." class="icon icon-home"> Brel git repo
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../examples/">Examples</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../Loading%20from%20EDGAR/">EDGAR</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../changelog/">Changelog</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Brel Filings</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../brel-filings/filings/">Filings</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Facts</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/facts/">Facts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/contexts/">Contexts</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/aspects/">Aspects</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/characteristics/">Characteristics</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/concept-characteristic/">Concept Characteristic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/entity-characteristic/">Entity Characteristic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/period-characteristic/">Period Characteristic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/unit-characteristic/">Unit Characteristic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/explicit-dimension-characteristic/">Explicit Dimension Characteristic</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../facts/typed-dimension-characteristic/">Typed Dimension Characteristic</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Components</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../components/components/">Components</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../components/networks/">Networks</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../components/network-nodes/">Network Nodes</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../components/calculation-networks-and-nodes/">Calculation Networks and Nodes</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Report Elements</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../report-elements/report-elements/">Report Elements</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../report-elements/concept/">Concept</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../report-elements/abstract/">Abstract</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../report-elements/line-items/">Line Items</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../report-elements/hypercube/">Hypercube</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../report-elements/dimension/">Dimension</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../report-elements/member/">Member</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">QNames</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="../qnames-and-namespace-maps/">QNames and Namespace maps</a>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="./">Namespace normalization</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#normalize_nsmap">normalize_nsmap</a>
    </li>
    </ul>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../..">Brel git repo</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../.." class="icon icon-home" aria-label="Docs"></a></li>
          <li class="breadcrumb-item">QNames</li>
      <li class="breadcrumb-item active">Namespace normalization</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/BrelLibrary/brel/edit/master/docs/qnames/namespace-normalization.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <p><a id="brel.parsers.XML.xml_namespace_normalizer"></a></p>
<h1 id="brelparsersxmlxml_namespace_normalizer">brel.parsers.XML.xml_namespace_normalizer</h1>
<p>This module contains the XML namespace normalizer.</p>
<p>It is not intended to be used by the user directly. Rather, it is used by the XML parser to normalize the namespace mappings.</p>
<p>In XML, namespaces can be defined per element. Therefore, the same prefix can map to different urls and the same url can map to different prefixes.
It all depends on the context in which the prefix is used. From a user perspective, this is very confusing. 
When a user looks for e.g. us-gaap:Assets, he usually doesn't care if it is us-gaap's 2022 or 2023 version. 
Also, if the filing calls the prefix us-gaap1 instead of us-gaap for some contexts, then the user will have to know this and use the correct prefix.</p>
<p>Namespace normalizing turns the nested namespace mappings into a flat namespace mapping. It also generates redirects and renames for the prefixes.
For the example above, it would generate the following mapping:</p>
<ul>
<li>us-gaap -&gt; us-gaap-2023-01-31</li>
<li>redirect: us-gaap1 -&gt; us-gaap</li>
</ul>
<p>More precisely, it does the following:</p>
<ul>
<li>It groups the prefix-&gt;url mappings by their unversioned url.</li>
<li>For each group, it picks the main prefix and the latest version of the url.</li>
<li>For each non-main prefix, it generates a redirect to the main prefix.</li>
</ul>
<p>Renames are generated if two completely different urls are mapped to the same prefix.
In that case, the name of the prefix is changed to a new prefix.
A rename has the following form: </p>
<ul>
<li>old_url -&gt; (old_prefix, new_prefix)</li>
</ul>
<p>====================</p>
<ul>
<li>author: Robin Schmidiger</li>
<li>version: 0.4</li>
<li>date: 21 January 2024</li>
</ul>
<p>====================</p>
<p><a id="brel.parsers.XML.xml_namespace_normalizer.normalize_nsmap"></a></p>
<h4 id="normalize_nsmap">normalize_nsmap</h4>
<pre><code class="language-python">def normalize_nsmap(
        namespace_mappings: list[dict[str, str]]) -&gt; dict[str, dict[str, str]]
</code></pre>
<p>Given a list of namespace mappings, normalize the namespace mappings and returns the normalized namespace mapping and the redirects.</p>
<p>A mapping is considered normalized if there is a 1:1 mapping between prefixes and urls.
If a prefix maps to multiple urls, then the latest version of the url is chosen.
If multiple prefixes map to the same url, then the shortest prefix is chosen as the main prefix.
The other prefixes are redirected to the main prefix.</p>
<p><strong>Arguments</strong>:</p>
<ul>
<li><code>namespace_mappings</code>: A list of namespace mappings.</li>
</ul>
<p><strong>Returns</strong>:</p>
<p><code>dict</code>: A dictionary containing the normalized namespace mapping and the redirects.</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../qnames-and-namespace-maps/" class="btn btn-neutral float-left" title="QNames and Namespace maps"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/BrelLibrary/brel" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../qnames-and-namespace-maps/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "../..";</script>
    <script src="../../js/theme_extra.js"></script>
    <script src="../../js/theme.js"></script>
      <script src="../../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
